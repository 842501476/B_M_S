<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Backstage Management System</title>
    <link rel="icon" href="../images/icon.jpg">
    <link rel="stylesheet" href="../lib/layui/css/layui.css">
    <link rel="stylesheet" href="../css/search.css">
    <script src="../lib/jquery-1.10.1.min.js"></script>
    <script src="../lib/layui/layui.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/user-defined.js"></script>

    <style>
        html {
            user-select: none;
        }
    </style>
</head>

<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <div class="layui-logo" style="background: url(../images/hlogo.jpg) no-repeat center"></div>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <ul class="layui-nav layui-layout-left" style="height:60px;">
                <li class="layui-nav-item" style="padding-bottom: 20px;height:60px;line-height: 65px;"><a
                        href="index.html">首页</a></li>


                <div class="layui-form component" style="margin-top:15px;">
                    <select name="modules" lay-verify="required" lay-search="">
                        <option value="">直接选择或搜索选择</option>
                        <option value="1">layer</option>
                        <option value="2">form</option>
                        <option value="3">layim</option>
                        <option value="4">element</option>
                        <option value="5">laytpl</option>
                        <option value="6">upload</option>
                        <option value="7">laydate</option>
                        <option value="8">laypage</option>
                        <option value="9">flow</option>
                        <option value="10">util</option>
                    </select>
                    <div class="layui-unselect layui-form-select">
                        <div class="layui-select-title"><input type="text" placeholder="直接选择或搜索选择" value=""
                                class="layui-input layui-unselect"><i></i></div>
                        <dl class="layui-anim layui-anim-upbit">
                            <dd lay-value="1" class="">layer</dd>
                            <dd lay-value="2" class="">form</dd>
                            <dd lay-value="3" class="">layim</dd>
                            <dd lay-value="4" class="">element</dd>
                            <dd lay-value="5" class="">laytpl</dd>
                            <dd lay-value="6" class="">upload</dd>
                            <dd lay-value="7" class="">laydate</dd>
                            <dd lay-value="8" class="">laypage</dd>
                            <dd lay-value="9" class="">flow</dd>
                            <dd lay-value="10" class="">util</dd>
                        </dl>
                    </div>
                    <i class="layui-icon"></i>
                </div>


                <!-- 天气 -->
                <li class="layui-nav-item" style="height:60px;padding-bottom: 20px;line-height: 55px;">
                    <div class="
                    weather" pc>
                        <div id="tp-weather-widget"></div>
                        <script src="../js/weather.js"></script>
                    </div>
                </li>
            </ul>

            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <img src="../images/xxx.jpg" class="layui-nav-img">
                        <span class="welcome"></span>
                    </a>
                </li>
                <li class="layui-nav-item lockcms" pc>
                    <a href="javascript:;"><i class="iconfont icon-lock1"></i><cite>锁屏</cite></a>
                </li>
                <li class="layui-nav-item loginout"><a href="javascript:;">退出</a></li>
            </ul>
        </div>

        <div class="layui-side layui-bg-black">
            <div class="layui-side-scroll">
                <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item layui-nav-itemed">
                        <a class="" href="javascript:;">商品管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="goodlist.html">商品列表</a></dd>
                            <dd><a href="goodtype.html">商品分类</a></dd>
                            <dd class="layui-this"><a href="addgoods.html">添加商品</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="javascript:;">用户管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="user.html">用户列表</a></dd>
                            <dd><a href="adduser.html">用户添加</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="javascript:;">订单管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="orderlist.html">订单列表</a></dd>
                        </dl>
                    </li>

                </ul>
            </div>
        </div>

        <div class="layui-body">
            <!-- 内容主体区域 -->
            <div style="padding: 20px; border: 10px solid #ccc;border-right: none">
                <span class="layui-breadcrumb">
                    <a href="index.html">首页</a>
                    <a href="javascript:;">商品管理</a>
                    <a><cite>商品添加</cite></a>
                </span>
                <div class="layui-form layui-form-pane" action="" style="padding: 50px; width: 800px;">
                    <div class="layui-form-item">
                        <label class="layui-form-label">商品名称</label>
                        <div class="layui-input-block">
                            <input type="text" name="title" id="goodname" autocomplete="off" placeholder="请输入标题"
                                class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">商品副标题</label>
                        <div class="layui-input-block">
                            <input type="text" name="title" id="goodtitle" autocomplete="off" placeholder="请输入副标题"
                                class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">旧商品价格</label>
                        <div class="layui-input-inline">
                            <input type="text" name="title" id="oldprice" autocomplete="off" placeholder="商品价格"
                                class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">新商品价格</label>
                        <div class="layui-input-inline">
                            <input type="text" name="title" id="newprice" autocomplete="off" placeholder="商品价格"
                                class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">商品分类</label>
                            <div class="layui-input-inline">
                                <select name="modules" lay-search="" lay-verify="required" id="htype">
                                    <!-- <option value="">直接选择或搜索选择</option> -->
                                    <option value="手机" selected>手机</option>
                                    <option value="平板">平板</option>
                                    <option value="电脑">电脑</option>
                                    <option value="配件">配件</option>
                                    <option value="办公">办公</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <button type="button" class="layui-btn" id="test1">
                            <i class="layui-icon">&#xe67c;</i>上传图片
                        </button>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">库存</label>
                        <div class="layui-input-inline">
                            <input type="text" name="title" id="kucun" autocomplete="off" placeholder="库存"
                                class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">商品属性</label>
                        <div class="layui-input-block">
                            <input type="checkbox" name="like[remai]" title="热卖">
                            <input type="checkbox" name="like[cuxiao]" title="促销">
                            <input type="checkbox" name="like[tuijian]" title="推荐">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">状态</label>
                        <div class="layui-input-inline">
                            <select name="modules" lay-search="" lay-verify="required" id="zhuangtai">
                                <option value="上线">上线</option>
                                <option value="下架">下架</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">商品描述</label>
                        <div class="layui-input-block">
                            <textarea placeholder="请输入内容" class="layui-textarea" name="desc" lay-verify="required"
                                id="miaoshu"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit="" lay-filter="demo1" id="htj">立即提交</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-footer" style="text-align:center">
            <!-- 底部固定区域 -->
            © 2019.2.27 Backstage Management System
        </div>
    </div>
    <script>
        var data = decodeURI(location.search);//获取从列表页传过来的商品id
        var now = data.slice(1);//切割
        // console.log(data, now);
        if (now) {
            let xhr = new XMLHttpRequest();
            xhr.onload = () => {
                if (xhr.status == 200) {
                    let res = JSON.parse(xhr.responseText);
                    // let res = xhr.responseText;
                    // console.log(res);
                    // console.log(res[0].type);
                    // var goodname = document.querySelector('#goodname');
                    $('#goodname').val(res[0].goodname);
                    $('#goodtitle').val(res[0].type + '专属品牌商品：' + res[0].goodname);
                    $('#newprice').val(res[0].newprice);
                    $('#oldprice').val(res[0].oldprice);
                    $('#kucun').val(res[0].kucun);
                    $('#htype').val(res[0].type);
                    $('#zhuangtai').val(res[0].zhuangtai);
                    $('#miaoshu').val("品牌：" + res[0].goodname + "，价格：" + res[0].newprice);
                }
            }
            xhr.open('post', '/addgoods', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            let datas = `_id=${now}`;
            // console.log(datas);
            xhr.send(datas);
        }

        let htj = document.getElementById("htj");
        let goodname = document.getElementById("goodname");
        let oldprice = document.getElementById("oldprice");
        let newprice = document.getElementById("newprice");
        let kucun = document.getElementById("kucun");
        let htype = document.getElementById("htype");
        let zhuangtai = document.getElementById("zhuangtai");

        // 编辑修改分支
        if (now) {
            htj.onclick = function () {
                // console.log($('#htype').val());
                let _goodname = goodname.value;
                let _newprice = newprice.value;
                let _oldprice = oldprice.value;
                let _kucun = kucun.value;
                let _htype = htype.value;
                let _zhuangtai = zhuangtai.value;
                // console.log(_htype);
                if (_goodname && _newprice && _oldprice && _kucun && _htype && _zhuangtai) {
                    let xhr = new XMLHttpRequest();
                    xhr.onload = () => {
                        if (xhr.status == 200) {
                            let res = JSON.parse(xhr.responseText);
                            // console.log(str);
                            if (res) {
                                layer.msg("修改成功！");
                                // window.location.href = './goodlist.html';
                                setTimeout("window.location.href = './goodlist.html'", 3000);
                            }
                        }
                    }
                    xhr.open('post', '/addgoods3', true);
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                    let data = `_id=${now}&goodname=${_goodname}&newprice=${_newprice}&oldprice=${_oldprice}&kucun=${_kucun}&type=${_htype}&zhuangtai=${_zhuangtai}`
                    xhr.send(data)
                }
                else {
                    layer.msg("请填写完整！");
                }
            }
        }
        //添加商品
        else {
            htj.onclick = function () {
                // console.log($('#htype').val());
                let _goodname = goodname.value;
                let _newprice = newprice.value;
                let _oldprice = oldprice.value;
                let _kucun = kucun.value;
                let _htype = htype.value;
                let _zhuangtai = zhuangtai.value;
                // console.log(_htype);
                if (_goodname && _newprice && _oldprice && _kucun && _htype && _zhuangtai) {
                    let xhr = new XMLHttpRequest();
                    xhr.onload = () => {
                        if (xhr.status == 200) {
                            let res = JSON.parse(xhr.responseText);
                            if (res) {
                                layer.msg("添加成功！");
                                // window.location.href = './goodlist.html';
                                //延时跳转页面
                                setTimeout("window.location.href = './goodlist.html'", 3000);
                            }
                        }
                    }
                    xhr.open('post', '/addgoods2', true);
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                    let data = `goodname=${_goodname}&newprice=${_newprice}&oldprice=${_oldprice}&kucun=${_kucun}&type=${_htype}&zhuangtai=${_zhuangtai}`
                    xhr.send(data)
                }
                else {
                    layer.msg("请填写完整！");
                }
            }
        }

        //JavaScript代码区域
        layui.use(['element', 'form', 'upload'], function () {
            var element = layui.element
                , form = layui.form
                , $ = layui.jquery
                , upload = layui.upload;

            form.render();

            //拖拽上传
            upload.render({
                elem: '#test1',
            });
        });
    </script>

</body>
<script src="../js/token.js"></script>

</html>